//@version=5
strategy("BTCUSDT Simple Webhook Strategy", overlay=true, initial_capital=10000, default_qty_type=strategy.percent_of_equity, default_qty_value=10)

// ==================== íŒŒë¼ë¯¸í„° ì„¤ì • ====================

// ì´ë™í‰ê· ì„ 
fastLength = input.int(9, "Fast EMA", minval=1)
slowLength = input.int(21, "Slow EMA", minval=1)

// ë ˆë²„ë¦¬ì§€ (ì‹¤ì œ ê±°ë˜ì†Œì—ì„œ ì ìš©)
leverage = input.int(3, "Leverage", minval=1, maxval=125)

// Webhook ì„¤ì •
account_id = input.string("your_account_id", "Account ID", tooltip="accounts-secure APIì—ì„œ ë°œê¸‰ë°›ì€ ê³„ì • ID")
webhook_secret = input.string("your_webhook_secret", "Webhook Secret", tooltip=".env íŒŒì¼ì˜ WEBHOOK_SECRET")

// ==================== ì§€í‘œ ê³„ì‚° ====================

fastEMA = ta.ema(close, fastLength)
slowEMA = ta.ema(close, slowLength)

// ë§¤ìˆ˜/ë§¤ë„ ì‹œê·¸ë„
longCondition = ta.crossover(fastEMA, slowEMA)
shortCondition = ta.crossunder(fastEMA, slowEMA)

// ==================== ì°¨íŠ¸ í‘œì‹œ ====================

plot(fastEMA, "Fast EMA", color=color.blue, linewidth=2)
plot(slowEMA, "Slow EMA", color=color.red, linewidth=2)

// ë§¤ìˆ˜/ë§¤ë„ ì‹ í˜¸ í‘œì‹œ
plotshape(longCondition, "Long", shape.triangleup, location.belowbar, color.green, size=size.small)
plotshape(shortCondition, "Short", shape.triangledown, location.abovebar, color.red, size=size.small)

// ==================== Webhook ì£¼ë¬¸ ====================

// Binance Futures ë¡± ì§„ì…
if (longCondition and strategy.position_size == 0)
    strategy.entry("Long", strategy.long)
    alert('{"account_id":"' + account_id + '","exchange":"binance","action":"long","symbol":"BTCUSDT","leverage":' + str.tostring(leverage) + ',"secret":"' + webhook_secret + '","timestamp":' + str.tostring(timenow / 1000) + '}', alert.freq_once_per_bar_close)

// Binance Futures ìˆ ì§„ì…
if (shortCondition and strategy.position_size == 0)
    strategy.entry("Short", strategy.short)
    alert('{"account_id":"' + account_id + '","exchange":"binance","action":"short","symbol":"BTCUSDT","leverage":' + str.tostring(leverage) + ',"secret":"' + webhook_secret + '","timestamp":' + str.tostring(timenow / 1000) + '}', alert.freq_once_per_bar_close)

// ë¡± í¬ì§€ì…˜ ì²­ì‚° (ë°˜ëŒ€ ì‹œê·¸ë„)
if (shortCondition and strategy.position_size > 0)
    strategy.close("Long")
    alert('{"account_id":"' + account_id + '","exchange":"binance","action":"close_long","symbol":"BTCUSDT","secret":"' + webhook_secret + '","timestamp":' + str.tostring(timenow / 1000) + '}', alert.freq_once_per_bar_close)

// ìˆ í¬ì§€ì…˜ ì²­ì‚° (ë°˜ëŒ€ ì‹œê·¸ë„)
if (longCondition and strategy.position_size < 0)
    strategy.close("Short")
    alert('{"account_id":"' + account_id + '","exchange":"binance","action":"close_short","symbol":"BTCUSDT","secret":"' + webhook_secret + '","timestamp":' + str.tostring(timenow / 1000) + '}', alert.freq_once_per_bar_close)

// ==================== ì„¤ëª… ====================

// ğŸ“Œ ì‚¬ìš© ë°©ë²•:
// 1. TradingViewì—ì„œ Binance Futures: BTCUSDT ì°¨íŠ¸ ì—´ê¸°
// 2. ì´ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
// 3. account_idì™€ webhook_secret ì…ë ¥
// 4. "ì•Œë¦¼ ìƒì„±" â†’ Webhook URL: http://your-backend-url/api/v1/webhook/tradingview
// 5. ì•Œë¦¼ ë©”ì‹œì§€ì— {{strategy.order.alert_syntax}} ì‚¬ìš©
//
// ğŸ“Œ ì§€ì› ê±°ë˜ì†Œ:
// - Binance Futures (BTCUSDT Perpetual)
// - OKX Futures (BTC-USDT-SWAP) - exchangeë¥¼ "okx"ë¡œ ë³€ê²½
//
// ğŸ“Œ ë ˆë²„ë¦¬ì§€:
// - ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” 3ë°° ë ˆë²„ë¦¬ì§€ ê¸°ë³¸ê°’
// - ì‹¤ì œ ë ˆë²„ë¦¬ì§€ëŠ” ë°±ì—”ë“œì—ì„œ ì„¤ì •ë¨
//
// ğŸ“Œ ì£¼ì˜ì‚¬í•­:
// - ë°˜ë“œì‹œ í…ŒìŠ¤íŠ¸ë„·ì—ì„œ ë¨¼ì € í…ŒìŠ¤íŠ¸!
// - Webhook URLì€ HTTPS ê¶Œì¥
// - account_idëŠ” ë¡œê·¸ì¸ í›„ ê³„ì • ê´€ë¦¬ì—ì„œ í™•ì¸
